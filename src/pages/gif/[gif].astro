---
import type { GifResponse } from "../../types/types"

import Layout from "../../layouts/Layout.astro"
import { dataMapper } from "../../utils/gifResponseMapper"

const { gif } = Astro.params

import { LikeButton } from "../../components/LikeButton"
// Service
import { TENOR_API_KEY } from "../../environment/environment"

const URL = `https://tenor.googleapis.com/v2/posts?key=${TENOR_API_KEY}&ids=${gif}`

const response = await fetch(URL)
const data: GifResponse = await response.json()
const mappedGif = dataMapper(data.results[0])

const Capitalize = (word: string) => {
  return word.charAt(0).toUpperCase() + word.slice(1)
}

let likes = 20 //viene de la base de datos
---

<Layout title=`Your Gif: ${Capitalize(mappedGif.tags[0])}`>
  <div class="flex gap-8">
    <!--  -->

    <div class="flex w-1/3 flex-shrink-0 flex-col gap-y-4">
      <h1 class="text-4xl">Your GIF: {mappedGif.alt}</h1>
      <img
        alt="gif"
        class="w-full rounded-md border-4 border-double"
        src={`${mappedGif.images.gif}`}
      />
    </div>

    <!--  -->

    <div class="flex flex-col justify-center gap-4 text-xl">
      <h3>{mappedGif.alt}</h3>
      <span>Tags:</span>
      <div class="flex flex-wrap gap-2">
        {
          mappedGif.tags.map((tag) => (
            <button class="rounded-lg border px-2 py-1 transition-colors hover:bg-white/90 hover:text-black">
              {tag}
            </button>
          ))
        }
      </div>
      <br />
      <br />
      <span>Share:</span>
      <div class="flex gap-4">
        {
          ["Instagram", "Twitter", "Facebook"].map((tag) => (
            <button class="rounded-lg border px-2 py-1 transition-colors hover:bg-white/90 hover:text-black">
              {tag}
            </button>
          ))
        }
      </div>
      <!-- <button
        class="w-fit rounded-md border border-red-950 px-2 py-1 text-red-600 transition-colors hover:bg-red-500 hover:text-black"
        id="likeButton"
        onclick="handleLike()"
        >Like {likes}
      </button> -->
      <LikeButton client:only="react" />
    </div>
  </div>
</Layout>

<!-- <script is:inline>
  // Obtenemos el valor de likes de DataBase
  let likes = JSON.parse(localStorage.getItem("likes"))

  // Update DataBase
  function addLike() {
    localStorage.setItem("likes", JSON.stringify(likes + 1))
  }

  function removeLike() {
    localStorage.setItem("likes", JSON.stringify(likes - 1))
  }

  function handleLike() {
    if (JSON.parse(localStorage.getItem("likes")) + 1 === likes) {
      likes += 1
    } else {
      likes -= 1
    }

    document.getElementById("likeButton").innerHTML = `Like ${likes}`
    console.log("Liked", likes)
  }
</script> -->
